<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<title>Etheria Enemy Speed Tool</title>

<style>
body{
 background:#253047;
 font-family:Arial;
 display:flex;
 justify-content:center;
 padding:30px;
}

.grid{
 display:grid;
 grid-template-columns:300px 120px 120px 120px 240px 170px;
 background:#000;
 gap:2px;
 padding:2px;
}

.cell{
 background:#d1d5db;
 height:46px;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:15px;
 color:#111;
}

.head{
 background:#aeb7c2;
 font-weight:bold;
}

.result{
 background:#eef2f7;
 font-weight:bold;
}

input,select{
 width:100%;
 height:100%;
 border:none;
 text-align:center;
 font-size:15px;
 background:white;
}

.or{
 background:#cbd5e1;
 font-weight:bold;
}
</style>

</head>

<body>

<div class="grid">

<div class="cell head">Total Speed</div>
<div class="cell head">base speed</div>
<div class="cell head">prowess speed</div>
<div class="cell head">shell speed</div>
<div class="cell head">module set spd bonus sum</div>
<div class="cell head">modules speed roll</div>

<div class="cell"><select id="hero"></select></div>
<div class="cell result" id="baseSPD"></div>
<div class="cell result" id="prowSPD"></div>
<div class="cell"><input id="shell"></div>
<div class="cell"><input id="set"></div>
<div class="cell">mask</div>

<div class="cell result" id="totalSPD"></div>
<div class="cell"></div>
<div class="cell"></div>
<div class="cell"></div>
<div class="cell"></div>
<div class="cell">transistor</div>

<div class="cell head">Enemy Speed</div>
<div class="cell head">my speed</div>
<div class="cell head">my turn meter</div>
<div class="cell head">his turn meter</div>
<div class="cell head">Enemy Speed Manual</div>
<div class="cell">wristwheel</div>

<div class="cell result" id="enemySPD"></div>
<div class="cell"><input id="myspd"></div>
<div class="cell"><input id="mytm"></div>
<div class="cell"><input id="histm"></div>
<div class="cell"><input id="enemymanual"></div>
<div class="cell">core I</div>

<div class="cell head">Enemy module sum speed</div>
<div class="cell result" id="enemyModule"></div>
<div class="cell"></div>
<div class="cell"></div>
<div class="cell"></div>
<div class="cell">core II</div>

<div class="cell"></div>
<div class="cell"><input class="roll"></div>
<div class="cell"><input class="roll"></div>
<div class="cell"><input class="roll"></div>
<div class="cell"><input class="roll"></div>
<div class="cell">core III</div>

<div class="cell"></div>
<div class="cell result" id="rollSum"></div>
<div class="cell or">OR</div>
<div class="cell"><input id="manual"></div>
<div class="cell"></div>
<div class="cell"></div>

</div>

<script>

const CSV_LINK="https://docs.google.com/spreadsheets/d/e/2PACX-1vSCQD7EM8DG1oZVexXto376AAHwiikJWgAENIRfBX_kFV4vqDXduenXAL9m0LUiju8HtdaWrQvOzw8j/pub?gid=613669233&single=true&output=csv";

let DB={};

fetch(CSV_LINK)
.then(r=>r.text())
.then(csv=>{

 const rows=csv.trim().split("\n");
 const sel=document.getElementById("hero");

 rows.forEach(r=>{
   const c=r.split(",");
   DB[c[0]]={base:Number(c[1]),prow:Number(c[2])};

   const opt=document.createElement("option");
   opt.value=c[0];
   opt.textContent=c[0];
   sel.appendChild(opt);
 });

 calc();
});

document.querySelectorAll("input,select")
.forEach(e=>e.addEventListener("input",calc));

function calc(){

const heroName=document.getElementById("hero").value;
const hero=DB[heroName]||{base:0,prow:0};

const B2=hero.base;
const C2=hero.prow;
const D2=num("shell");
const E2=num("set");

baseSPD.innerText=B2;
prowSPD.innerText=C2;

// ===== SUM(G2:G7)
const rolls=[...document.querySelectorAll(".roll")]
.map(e=>Number(e.value)||0);

const G8=rolls.reduce((a,b)=>a+b,0);
rollSum.innerText=G8;

const G10=num("manual");

// ===== TOTAL SPEED (A4 EXACT)
let total;
if(G8!==0)
 total=B2*(1+E2/100)+C2+D2+40+G8;
else
 total=B2*(1+E2/100)+C2+D2+40+G10;

totalSPD.innerText=Math.round(total);

// ===== ENEMY SPEED (A13 EXACT EXCEL)
const B13=num("myspd");
const C13=document.getElementById("mytm").value;
const D13=document.getElementById("histm").value;

let A13="";

if(C13!=="")
 A13=B13/(Number(C13)/100);
else if(D13!=="")
 A13=B13*(Number(D13)/100);

enemySPD.innerText=A13?Math.round(A13):"";

// ===== ENEMY MODULE SUM (A9 EXACT)
const E7=num("enemymanual");

let A9="";

if(A13!=="")
 A9=A13-(B2*(1+E2/100))-C2-D2-40;
else if(E7!==0)
 A9=E7-(B2*(1+E2/100))-C2-D2-40;

enemyModule.innerText=A9?Math.round(A9):"";

}

function num(id){
 return Number(document.getElementById(id).value)||0;
}

</script>

</body>
</html>
